From f500275e774945c8c19dc3e763510f04bca52261 Mon Sep 17 00:00:00 2001
From: Allan Sandfeld Jensen <allan.jensen@qt.io>
Date: Tue, 31 Jul 2018 15:42:09 +0200
Subject: Fix build with plugins enabled and webrtc disabled

Change-Id: I2f4f9517943571ba89fdb6a48fd4381d179a96a6
Reviewed-by: Alexandru Croitor <alexandru.croitor@qt.io>
---
 chromium/content/renderer/pepper/pepper_media_device_manager.cc | 7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

diff --git a/chromium/content/renderer/pepper/pepper_media_device_manager.cc b/chromium/content/renderer/pepper/pepper_media_device_manager.cc
index 2a1593afe4..99f2c3fb7f 100644
--- a/src/3rdparty/chromium/content/renderer/pepper/pepper_media_device_manager.cc
+++ b/src/3rdparty/chromium/content/renderer/pepper/pepper_media_device_manager.cc
@@ -114,9 +114,10 @@ void PepperMediaDeviceManager::EnumerateDevices(
                      callback, ToMediaDeviceType(type)));
 #else
   base::ThreadTaskRunnerHandle::Get()->PostTask(
-      FROM_HERE, base::Bind(&PepperMediaDeviceManager::DevicesEnumerated,
-                            AsWeakPtr(), callback, ToMediaDeviceType(type),
-                            std::vector<MediaDeviceInfoArray>()));
+      FROM_HERE, base::BindOnce(&PepperMediaDeviceManager::DevicesEnumerated,
+                                AsWeakPtr(), callback, ToMediaDeviceType(type),
+                                std::vector<MediaDeviceInfoArray>(),
+                                std::vector<blink::mojom::VideoInputDeviceCapabilitiesPtr>()));
 #endif
 }
 
-- 
cgit v1.2.1

From 26d7e8597239035a2b57c73c92743dcdeffa9368 Mon Sep 17 00:00:00 2001
From: Allan Sandfeld Jensen <allan.jensen@qt.io>
Date: Tue, 31 Jul 2018 18:40:01 +0200
Subject: FIXUP: Fix build with plugins enabled and webrtc disabled

Also fix linking error, and turn it into a compiler error in the future.

Change-Id: Ic6841eb70b40bd894495036d9d8d5a0a78fcf2b0
Reviewed-by: Alexandru Croitor <alexandru.croitor@qt.io>
---
 chromium/content/renderer/pepper/pepper_media_device_manager.cc | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/chromium/content/renderer/pepper/pepper_media_device_manager.cc b/chromium/content/renderer/pepper/pepper_media_device_manager.cc
index 99f2c3fb7f..19ff8c2e02 100644
--- a/src/3rdparty/chromium/content/renderer/pepper/pepper_media_device_manager.cc
+++ b/src/3rdparty/chromium/content/renderer/pepper/pepper_media_device_manager.cc
@@ -12,13 +12,16 @@
 #include "base/threading/thread_task_runner_handle.h"
 #include "content/public/common/console_message_level.h"
 #include "content/public/common/content_features.h"
-#include "content/renderer/media/stream/media_stream_device_observer.h"
 #include "content/renderer/pepper/renderer_ppapi_host_impl.h"
 #include "content/renderer/render_frame_impl.h"
 #include "media/media_buildflags.h"
 #include "ppapi/shared_impl/ppb_device_ref_shared.h"
 #include "services/service_manager/public/cpp/interface_provider.h"
 
+#if BUILDFLAG(ENABLE_WEBRTC)
+#include "content/renderer/media/stream/media_stream_device_observer.h"
+#endif
+
 namespace content {
 
 namespace {
@@ -267,8 +270,10 @@ void PepperMediaDeviceManager::OnDeviceOpened(int request_id,
     return;
   }
 
+#if BUILDFLAG(ENABLE_WEBRTC)
   if (success)
     GetMediaStreamDeviceObserver()->AddStream(label, device);
+#endif
 
   OpenDeviceCallback callback = iter->second;
   open_callbacks_.erase(iter);
-- 
cgit v1.2.1

